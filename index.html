<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bike Consumption Tracking Dashboard</title>

<style>
* { 
    margin: 0; 
    padding: 0; 
    box-sizing: border-box; 
}

body { 
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
    background: #f3f4f6;
    padding: 20px;
    min-height: 100vh;
}

.container { 
    max-width: 1600px; 
    margin: 0 auto; 
}

/* ---------- HEADER ---------- */
.header {
    background: linear-gradient(135deg, #7c3aed 0%, #a78bfa 100%);
    padding: 30px; 
    border-radius: 12px; 
    color: white;
    margin-bottom: 20px; 
    box-shadow: 0 4px 12px rgba(124, 58, 237, 0.3);
}

.header h1 {
    font-size: 28px;
    margin-bottom: 8px;
}

.header p {
    font-size: 16px;
    opacity: 0.9;
}

.header-grid {
    display: grid;
    grid-template-columns: 1fr auto;
    gap: 20px;
    align-items: center;
}

#clock { 
    font-size: 28px; 
    font-weight: bold; 
    color: #fef08a;
    text-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

/* ---------- ALERT BOX ---------- */
.alert-box {
    background: #fef3c7;
    border-left: 4px solid #f59e0b;
    padding: 15px 20px;
    border-radius: 8px;
    margin-bottom: 20px;
}

.alert-box h3 {
    color: #92400e;
    font-size: 16px;
    margin-bottom: 8px;
}

.alert-box ul {
    margin-left: 20px;
    color: #78350f;
    font-size: 14px;
    line-height: 1.6;
}

/* ---------- CONTROLS ---------- */
.controls {
    background: white; 
    padding: 25px; 
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1); 
    margin-bottom: 20px;
}

.control-grid {
    display: grid; 
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
}

label { 
    font-weight: 600; 
    margin-bottom: 8px; 
    color: #374151; 
    display: block;
    font-size: 14px;
}

select, input[type="text"], input[type="number"] {
    width: 100%; 
    padding: 10px; 
    border: 1px solid #d1d5db;
    border-radius: 8px; 
    font-size: 14px;
    background: white;
    transition: border-color 0.2s;
}

select:focus, input[type="text"]:focus, input[type="number"]:focus {
    outline: none;
    border-color: #7c3aed;
}

button {
    padding: 10px 20px;
    background: #7c3aed;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    font-size: 14px;
    transition: background 0.2s;
}

button:hover {
    background: #6d28d9;
}

button:disabled {
    background: #9ca3af;
    cursor: not-allowed;
}

.hint-text {
    margin-top: 8px;
    font-size: 12px;
    color: #6b7280;
    line-height: 1.5;
}

/* ---------- DROPZONE ---------- */
#dropzone {
    border: 2px dashed #7c3aed; 
    padding: 30px; 
    text-align: center;
    border-radius: 10px; 
    background: #faf5ff; 
    cursor: pointer;
    color: #6d28d9; 
    font-weight: bold; 
    margin-bottom: 20px;
    transition: all 0.3s;
}

#dropzone:hover {
    background: #f3e8ff;
    border-color: #6d28d9;
}

#dropzone.dragover { 
    background: #e9d5ff;
    border-color: #7c3aed;
    transform: scale(1.02);
}

/* ---------- STATS GRID ---------- */
.stats-grid {
    display: grid; 
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 15px; 
    margin-bottom: 20px;
}

.stat-card {
    background: white; 
    padding: 20px; 
    border-radius: 10px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    transition: transform 0.2s;
}

.stat-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.stat-label { 
    color: #6b7280; 
    font-size: 13px; 
    margin-bottom: 8px;
    font-weight: 500;
}

.stat-value { 
    font-size: 28px; 
    font-weight: bold; 
    color: #1f2937;
}

.stat-subtext {
    font-size: 12px;
    color: #9ca3af;
    margin-top: 4px;
}

/* ---------- ROUTE DISPLAY ---------- */
.route-header {
    background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);
    padding: 20px; 
    border-radius: 10px;
    margin-bottom: 10px; 
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    color: white;
}

.route-header h3 {
    font-size: 20px;
    margin-bottom: 5px;
}

.route-header p {
    font-size: 14px;
    opacity: 0.9;
}

/* ---------- TABLES ---------- */
table {
    width: 100%; 
    background: white; 
    border-radius: 10px;
    overflow: hidden; 
    margin-bottom: 25px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}

th {
    background: #f9fafb; 
    padding: 12px 10px; 
    text-align: left;
    border-bottom: 2px solid #e5e7eb;
    font-weight: 600;
    color: #374151;
    font-size: 12px;
    white-space: nowrap;
}

td {
    padding: 12px 10px; 
    border-bottom: 1px solid #f3f4f6;
    font-size: 13px;
    color: #1f2937;
}

tr:hover { 
    background: #fef3c7; 
}

tr:last-child td {
    border-bottom: none;
}

/* ---------- BADGES ---------- */
.consumption-badge { 
    padding: 4px 10px; 
    border-radius: 20px; 
    font-size: 11px;
    font-weight: 600;
    display: inline-block;
}

.consumption-extreme { 
    background: #fee2e2; 
    color: #991b1b; 
}

.consumption-high { 
    background: #fed7aa; 
    color: #9a3412; 
}

.consumption-medium { 
    background: #fef3c7; 
    color: #92400e; 
}

.consumption-low { 
    background: #e5e7eb; 
    color: #6b7280; 
}

.coordinates {
    font-family: 'Courier New', monospace;
    font-size: 11px;
    color: #6b7280;
}

/* ---------- EMPTY STATE ---------- */
.empty-state {
    text-align: center;
    padding: 60px 20px;
    background: white;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.empty-state h3 {
    font-size: 24px;
    color: #7c3aed;
    margin-bottom: 10px;
}

.empty-state p {
    color: #6b7280;
    font-size: 16px;
}

/* ---------- RESPONSIVE ---------- */
@media (max-width: 768px) {
    .header-grid {
        grid-template-columns: 1fr;
        text-align: center;
    }
    
    .control-grid {
        grid-template-columns: 1fr;
    }
    
    .stats-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    table {
        font-size: 11px;
    }
    
    th, td {
        padding: 8px 6px;
    }
}
</style>
</head>

<body>
<div class="container">

<!-- HEADER -->
<div class="header">
    <div class="header-grid">
        <div>
            <h1>üìâ Bike Consumption Tracking Dashboard</h1>
            <p>Track daily bike usage and identify high-demand hotspots for restocking</p>
        </div>
        <div id="clock">00:00</div>
    </div>
</div>

<!-- FORMAT INSTRUCTIONS -->
<div class="alert-box">
    <h3>üìã Expected CSV Format:</h3>
    <ul>
        <li><strong>Columns:</strong> Hub_ID (ignored), Address, Latitude, Longitude, Area, Day1_Morning, Day1_Evening, Day2_Morning, Day2_Evening, ...</li>
        <li><strong>Hub Name:</strong> Will use the Address column (e.g., "63 Letbane Stations")</li>
        <li><strong>Area:</strong> Should be like "Copenhagen Indre By", "Copenhagen N√∏rrebro", "Copenhagen √òsterbro"</li>
        <li><strong>How it works:</strong> System calculates bike decreases between readings (e.g., Day1: 10 bikes ‚Üí Day2: 5 bikes = 5 bikes consumed)</li>
    </ul>
</div>

<!-- CSV DROPZONE -->
<div id="dropzone">
    üì• Drop CSV file here or click to upload
</div>

<!-- GOOGLE SHEET LOADER -->
<div class="controls">
    <label>üìÑ Load Google Sheet (public link)</label>
    <input type="text" id="sheetURL" placeholder="Paste Google Sheet link here...">
    <button onclick="loadGoogleSheet()">Load Sheet</button>
    <p class="hint-text">
        ‚ìò Sheet must be public. Expects daily bike counts for each hub to calculate consumption patterns.
    </p>
</div>

<!-- MAIN CONTROLS -->
<div class="controls">
    <div class="control-grid">
        <div>
            <label>üïê Shift Time</label>
            <select id="shiftSelect" onchange="updateDashboard()">
                <option value="morning">Morning Shift</option>
                <option value="evening">Evening Shift</option>
            </select>
        </div>

        <div>
            <label>üöó Number of Drivers</label>
            <select id="driversCount" onchange="updateDashboard()">
                <option value="1">1 Driver</option>
                <option value="2">2 Drivers</option>
                <option value="3">3 Drivers</option>
            </select>
        </div>

        <div>
            <label>üìç Hubs per Driver</label>
            <input type="number" id="hubsPerDriver" value="5" min="5" max="7" onchange="updateDashboard()">
            <p class="hint-text">Ideal: 5 hubs, Max: 7 hubs</p>
        </div>

        <div>
            <label>üìä Ranking Method</label>
            <select id="rankingMethod" onchange="updateDashboard()">
                <option value="total">Total Bikes Consumed (30d)</option>
                <option value="average">Average Daily Consumption</option>
                <option value="trend">Recent Trend (Last 7d)</option>
            </select>
        </div>
    </div>
</div>

<!-- STATISTICS CARDS -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-label">üöó Active Drivers</div>
        <div class="stat-value" id="activeDrivers">0</div>
    </div>
    <div class="stat-card">
        <div class="stat-label">üìç Priority Hubs</div>
        <div class="stat-value" id="totalHubs">0</div>
    </div>
    <div class="stat-card">
        <div class="stat-label">üî• Hottest Hub</div>
        <div class="stat-value" id="hottestHub">-</div>
        <div class="stat-subtext" id="hottestConsumption"></div>
    </div>
    <div class="stat-card">
        <div class="stat-label">üìâ Total Consumed (30d)</div>
        <div class="stat-value" id="totalConsumed">0</div>
        <div class="stat-subtext">bikes taken by users</div>
    </div>
    <div class="stat-card">
        <div class="stat-label">üìà Avg Daily Consumption</div>
        <div class="stat-value" id="avgDaily">0</div>
        <div class="stat-subtext">bikes/day across all hubs</div>
    </div>
</div>

<!-- ROUTES CONTAINER -->
<div id="routesContainer"></div>

</div>

<script>
/* =====================================
   CLOCK
   ===================================== */
function updateClock() {
    const now = new Date();
    const date = now.toLocaleDateString('en-US', { 
        month: 'short', 
        day: 'numeric', 
        year: 'numeric' 
    });
    const time = now.toLocaleTimeString('en-US', { 
        hour: '2-digit', 
        minute: '2-digit',
        hour12: true
    });
    document.getElementById("clock").textContent = `${date} ${time}`;
}
setInterval(updateClock, 1000);
updateClock();

/* =====================================
   CSV PARSER
   ===================================== */
function parseCSV(csv) {
    const rows = [];
    let currentField = "";
    let currentRow = [];
    let inQuotes = false;

    for (let i = 0; i < csv.length; i++) {
        const char = csv[i];
        const nextChar = csv[i + 1];

        if (char === '"') {
            if (inQuotes && nextChar === '"') {
                currentField += '"';
                i++;
            } else {
                inQuotes = !inQuotes;
            }
        } else if (char === "," && !inQuotes) {
            currentRow.push(currentField.trim());
            currentField = "";
        } else if ((char === "\n" || char === "\r") && !inQuotes) {
            if (char === "\r" && nextChar === "\n") {
                i++;
            }
            if (currentField.length > 0 || currentRow.length > 0) {
                currentRow.push(currentField.trim());
                if (currentRow.some(field => field.length > 0)) {
                    rows.push(currentRow);
                }
                currentRow = [];
                currentField = "";
            }
        } else {
            currentField += char;
        }
    }

    if (currentField.length > 0 || currentRow.length > 0) {
        currentRow.push(currentField.trim());
        if (currentRow.some(field => field.length > 0)) {
            rows.push(currentRow);
        }
    }

    return rows;
}

/* =====================================
   GLOBAL DATA
   ===================================== */
let hubsData = [];

/* =====================================
   FILE UPLOAD
   ===================================== */
document.getElementById("dropzone").onclick = () => {
    const input = document.createElement("input");
    input.type = "file";
    input.accept = ".csv";
    input.onchange = e => {
        if (e.target.files[0]) {
            loadCSVFile(e.target.files[0]);
        }
    };
    input.click();
};

document.getElementById("dropzone").addEventListener("dragover", e => {
    e.preventDefault();
    e.stopPropagation();
    e.currentTarget.classList.add("dragover");
});

document.getElementById("dropzone").addEventListener("dragleave", e => {
    e.preventDefault();
    e.stopPropagation();
    e.currentTarget.classList.remove("dragover");
});

document.getElementById("dropzone").addEventListener("drop", e => {
    e.preventDefault();
    e.stopPropagation();
    e.currentTarget.classList.remove("dragover");
    
    if (e.dataTransfer.files.length > 0) {
        loadCSVFile(e.dataTransfer.files[0]);
    }
});

function loadCSVFile(file) {
    if (!file || !file.name.endsWith('.csv')) {
        alert("Please select a CSV file");
        return;
    }

    const reader = new FileReader();
    reader.onload = e => {
        try {
            processCSV(e.target.result);
        } catch (error) {
            console.error("Error processing CSV:", error);
            alert("Error processing CSV file. Please check the format.");
        }
    };
    reader.onerror = () => alert("Error reading file");
    reader.readAsText(file);
}

/* =====================================
   REVERSE GEOCODING - Get neighborhood from coordinates
   ===================================== */
async function getNeighborhood(lat, lng) {
    try {
        // Using Nominatim (OpenStreetMap) - free, no API key needed
        const response = await fetch(
            `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&zoom=16&addressdetails=1`,
            {
                headers: {
                    'User-Agent': 'BikeRebalancingDashboard/1.0'
                }
            }
        );
        
        if (!response.ok) return null;
        
        const data = await response.json();
        const addr = data.address || {};
        
        // Build area string: "Copenhagen, Neighborhood"
        const city = addr.city || addr.town || addr.municipality || "Copenhagen";
        const neighborhood = addr.suburb || addr.neighbourhood || addr.quarter || addr.district || "";
        
        if (neighborhood) {
            return `${city}, ${neighborhood}`;
        }
        return city;
        
    } catch (error) {
        console.error("Geocoding error:", error);
        return null;
    }
}

/* =====================================
   PROCESS CSV
   ===================================== */
async function processCSV(csvText) {
    const rows = parseCSV(csvText);
    
    if (rows.length < 2) {
        alert("CSV file appears to be empty or invalid");
        return;
    }

    const headers = rows[0];
    const dataRows = rows.slice(1);

    // Show loading message
    document.getElementById("routesContainer").innerHTML = `
        <div class="empty-state">
            <h3>üîÑ Loading hub data...</h3>
            <p>Fetching neighborhood information for ${dataRows.length} hubs...</p>
        </div>
    `;

    // Detect format: columns after Area should be daily readings
    // Expected: Hub ID (ignore), Location (use as name), Lat, Lng, Area, Day1_Morning, Day1_Evening...
    
    const processedHubs = [];
    
    for (let i = 0; i < dataRows.length; i++) {
        const row = dataRows[i];
        
        if (row.length < 7 || !row[1].trim()) continue;
        
        const hubId = row[0] || "";
        const location = row[1] || "Unknown Location";
        const latitude = row[2] || "";
        const longitude = row[3] || "";
        let area = row[4] || "";
        
        // If area is empty or looks like "Unknown Area", try reverse geocoding
        if (!area || area === "Unknown Area" || area.trim() === "") {
            if (latitude && longitude) {
                const geocodedArea = await getNeighborhood(latitude, longitude);
                if (geocodedArea) {
                    area = geocodedArea;
                }
                // Rate limiting: wait 1 second between requests to respect Nominatim usage policy
                await new Promise(resolve => setTimeout(resolve, 1000));
            }
        }
        
        const name = location;
            
            // All remaining columns are daily bike counts (alternating morning/evening)
            const dailyCounts = row.slice(5).map(val => Number(val) || 0);
            
            // Calculate consumption: difference between consecutive readings
            const consumptions = [];
            for (let i = 1; i < dailyCounts.length; i++) {
                const decrease = dailyCounts[i - 1] - dailyCounts[i];
                if (decrease > 0) {
                    consumptions.push(decrease);
                }
            }
            
            const totalConsumed = consumptions.reduce((sum, val) => sum + val, 0);
            const avgDailyConsumption = consumptions.length > 0 ? totalConsumed / consumptions.length : 0;
            
            // Recent trend: last 7 readings
            const recentConsumptions = consumptions.slice(-7);
            const recentTrend = recentConsumptions.length > 0 
                ? recentConsumptions.reduce((sum, val) => sum + val, 0) / recentConsumptions.length 
                : 0;
            
            // Current status (last reading)
            const currentBikes = dailyCounts[dailyCounts.length - 1] || 0;
            
            return {
                name,
                hubId,
                latitude,
                longitude,
                area,
                dailyCounts,
                consumptions,
                totalConsumed,
                avgDailyConsumption,
                recentTrend,
                currentBikes
            };
        })
        .filter(hub => hub.totalConsumed > 0); // Only include hubs with consumption data

    if (hubsData.length === 0) {
        alert("No valid consumption data found. Make sure the CSV has daily bike counts.");
        return;
    }

    console.log(`Loaded ${hubsData.length} hubs with consumption data`);
    updateDashboard();
}

/* =====================================
   GOOGLE SHEET LOADER
   ===================================== */
async function loadGoogleSheet() {
    const btn = event.target;
    const originalText = btn.textContent;
    btn.textContent = "Loading...";
    btn.disabled = true;

    try {
        let url = document.getElementById("sheetURL").value.trim();

        if (!url) {
            alert("Please paste a Google Sheet URL");
            return;
        }

        if (!url.includes("docs.google.com")) {
            alert("Please paste a valid Google Sheet public link.");
            return;
        }

        const match = url.match(/\/d\/([a-zA-Z0-9-_]+)/);
        if (!match) {
            alert("Could not extract Sheet ID. Check your URL.");
            return;
        }

        const sheetID = match[1];
        const csvURL = `https://docs.google.com/spreadsheets/d/${sheetID}/export?format=csv`;

        const response = await fetch(csvURL);
        
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }

        const text = await response.text();
        
        if (!text || text.length < 10) {
            throw new Error("Sheet appears to be empty");
        }

        processCSV(text);
        alert("‚úÖ Google Sheet loaded successfully!");
        
    } catch (error) {
        console.error("Error loading Google Sheet:", error);
        alert(
            "‚ùå Error loading sheet. Make sure:\n\n" +
            "1. The sheet is set to 'Anyone with the link can view'\n" +
            "2. You copied the full URL from the address bar\n\n" +
            `Error: ${error.message}`
        );
    } finally {
        btn.textContent = originalText;
        btn.disabled = false;
    }
}

/* =====================================
   HELPER FUNCTIONS
   ===================================== */
function getConsumptionCategory(consumption, avgConsumption) {
    if (consumption >= avgConsumption * 2) return "EXTREME";
    if (consumption >= avgConsumption * 1.5) return "HIGH";
    if (consumption >= avgConsumption * 0.8) return "MEDIUM";
    return "LOW";
}

function getConsumptionBadgeClass(category) {
    switch(category) {
        case "EXTREME": return "consumption-extreme";
        case "HIGH": return "consumption-high";
        case "MEDIUM": return "consumption-medium";
        default: return "consumption-low";
    }
}

/* =====================================
   UPDATE DASHBOARD
   ===================================== */
function updateDashboard() {
    if (hubsData.length === 0) {
        console.log("No data to display");
        return;
    }

    const rankingMethod = document.getElementById("rankingMethod").value;
    const driversCount = Number(document.getElementById("driversCount").value);
    const hubsPerDriver = Number(document.getElementById("hubsPerDriver").value);
    const totalHubsNeeded = driversCount * hubsPerDriver;

    // Rank hubs by selected method
    let rankedHubs = [...hubsData];
    
    if (rankingMethod === "total") {
        rankedHubs.sort((a, b) => b.totalConsumed - a.totalConsumed);
    } else if (rankingMethod === "average") {
        rankedHubs.sort((a, b) => b.avgDailyConsumption - a.avgDailyConsumption);
    } else if (rankingMethod === "trend") {
        rankedHubs.sort((a, b) => b.recentTrend - a.recentTrend);
    }

    // Select top hubs
    const selectedHubs = rankedHubs.slice(0, totalHubsNeeded);
    
    // Calculate average consumption for categorization
    const avgConsumption = selectedHubs.reduce((sum, h) => sum + h.avgDailyConsumption, 0) / selectedHubs.length;

    // Add consumption category to each hub
    selectedHubs.forEach(hub => {
        hub.consumptionCategory = getConsumptionCategory(hub.avgDailyConsumption, avgConsumption);
    });

    /* =====================================
       DISTRIBUTE ACROSS DRIVERS
       ===================================== */
    const routes = [];
    for (let i = 0; i < driversCount; i++) {
        const start = i * hubsPerDriver;
        const end = start + hubsPerDriver;
        const driverHubs = selectedHubs.slice(start, end);
        
        if (driverHubs.length > 0) {
            routes.push(driverHubs);
        }
    }

    /* =====================================
       UPDATE STATISTICS
       ===================================== */
    document.getElementById("activeDrivers").textContent = routes.length;
    document.getElementById("totalHubs").textContent = selectedHubs.length;
    
    if (selectedHubs.length > 0) {
        const hottestHub = selectedHubs[0];
        document.getElementById("hottestHub").textContent = hottestHub.name;
        document.getElementById("hottestConsumption").textContent = 
            `${hottestHub.totalConsumed.toFixed(0)} bikes consumed`;
        
        const totalConsumed = selectedHubs.reduce((sum, h) => sum + h.totalConsumed, 0);
        document.getElementById("totalConsumed").textContent = totalConsumed.toFixed(0);
        
        const avgDaily = selectedHubs.reduce((sum, h) => sum + h.avgDailyConsumption, 0) / selectedHubs.length;
        document.getElementById("avgDaily").textContent = avgDaily.toFixed(1);
    }

    renderRoutes(routes);
}

/* =====================================
   RENDER ROUTES
   ===================================== */
function renderRoutes(routes) {
    const container = document.getElementById("routesContainer");
    container.innerHTML = "";

    if (routes.length === 0) {
        container.innerHTML = `
            <div class="empty-state">
                <h3>üìä No routes to display</h3>
                <p>Please upload consumption data to see priority hubs.</p>
            </div>
        `;
        return;
    }

    routes.forEach((route, routeIndex) => {
        const totalConsumed = route.reduce((sum, h) => sum + h.totalConsumed, 0);
        const avgConsumed = route.reduce((sum, h) => sum + h.avgDailyConsumption, 0) / route.length;

        let html = `
            <div class="route-header">
                <h3>üöó Driver ${routeIndex + 1} ‚Äî ${route.length} High-Demand Hubs</h3>
                <p>Total Consumed (30d): ${totalConsumed.toFixed(0)} bikes | Avg Daily: ${avgConsumed.toFixed(1)} bikes/day</p>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Demand</th>
                        <th>Address</th>
                        <th>Area (District)</th>
                        <th>Coordinates</th>
                        <th>Total Consumed (30d)</th>
                        <th>Avg Daily</th>
                        <th>Recent Trend (7d)</th>
                        <th>Current Bikes</th>
                    </tr>
                </thead>
                <tbody>
        `;

        route.forEach((hub, stopIndex) => {
            const badgeClass = getConsumptionBadgeClass(hub.consumptionCategory);
            const globalRank = hubsData.indexOf(hub) + 1;
            
            html += `
                <tr>
                    <td><strong>#${stopIndex + 1}</strong></td>
                    <td>
                        <span class="consumption-badge ${badgeClass}">
                            ${hub.consumptionCategory}
                        </span>
                    </td>
                    <td><strong>${hub.name}</strong></td>
                    <td>${hub.area}</td>
                    <td class="coordinates">${hub.latitude}, ${hub.longitude}</td>
                    <td><strong>${hub.totalConsumed.toFixed(0)}</strong> bikes</td>
                    <td><strong>${hub.avgDailyConsumption.toFixed(1)}</strong></td>
                    <td><strong>${hub.recentTrend.toFixed(1)}</strong></td>
                    <td>${hub.currentBikes}</td>
                </tr>
            `;
        });

        html += `
                </tbody>
            </table>
        `;

        container.innerHTML += html;
    });
}

/* =====================================
   INITIALIZATION
   ===================================== */
console.log("Bike Consumption Tracking Dashboard loaded");
console.log("Ready to analyze daily bike usage patterns...");
</script>

</body>
</html>
